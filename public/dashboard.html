<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | JapaSafe</title>
  <link href="/css/dashboard.css" rel="stylesheet">
</head>
<body>
  <div class="dashboard-layout">
    <aside class="sidebar">
      <!-- Your sidebar content -->
    </aside>
    <main class="main-content">
      <h1>Welcome to Your Dashboard</h1>
      <div id="protectedContent">
        <!-- Content will load only after auth check -->
      </div>
    </main>
  </div>

  <script type="module">
    import { auth, onAuthStateChanged } from '/js/firebase.js';
    import { getUserDocuments } from '/js/data/documents.js';

    // 1. Auth guard - redirect if not logged in
    onAuthStateChanged(auth, (user) => {
      const protectedContent = document.getElementById("protectedContent");
      
      if (!user) {
        console.warn("No user detected - redirecting to login");
        window.location.href = "/login.html";
      } else {
        console.log("User authenticated:", user.email);
        protectedContent.innerHTML = `
          <p>Logged in as: ${user.email}</p>
          <!-- Your dashboard components here -->
        `;
        loadDocuments(); // Load protected data
      }
    });

    // 2. Load protected data
    async function loadDocuments() {
      try {
        const docs = await getUserDocuments();
        console.log("Loaded documents:", docs);
        // Render your documents...
      } catch (error) {
        console.error("Failed to load documents:", error);
      }
    }
  </script>
</body>
</html>
